<!-- trades/templates/trades/strategy_list.html -->

{% extends 'trades/base.html' %}

{% block title %}Liste des Stratégies{% endblock %}

{% block content %}
<h2>Mes Stratégies</h2>
<a href="{% url 'strategy_new' %}" class="btn btn-success mb-3">Ajouter une Stratégie</a>
<table class="table table-striped table-responsive">
    <thead>
        <tr>
            <th>Nom</th>
            <th>Description</th>
            <th>Captures d'écran</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for strategy in strategies %}
        <tr>
            <td>{{ strategy.name }}</td>
            <td>{{ strategy.description|truncatewords:10 }}</td>
            <td>
                {% if strategy.screenshots.exists %}
                    {% with first_screenshot=strategy.screenshots.first %}
                        {% if first_screenshot %}
                            <a href="#" data-toggle="modal" data-target="#imageModal{{ strategy.pk }}">
                                <img src="{{ first_screenshot.image.url }}" alt="Screenshot" class="img-thumbnail" style="width: 100px; height: auto;">
                            </a>
                            <!-- Modal pour afficher les captures d'écran -->
                            <div class="modal fade" id="imageModal{{ strategy.pk }}" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel{{ strategy.pk }}" aria-hidden="true">
                              <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                <div class="modal-content">
                                  <div class="modal-body text-center">
                                    <div id="carousel{{ strategy.pk }}" class="carousel slide" data-ride="carousel">
                                      <div class="carousel-inner">
                                        {% for screenshot in strategy.screenshots.all %}
                                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                          <img src="{{ screenshot.image.url }}" class="d-block w-100" alt="Screenshot">
                                        </div>
                                        {% endfor %}
                                      </div>
                                      <a class="carousel-control-prev" href="#carousel{{ strategy.pk }}" role="button" data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Précédent</span>
                                      </a>
                                      <a class="carousel-control-next" href="#carousel{{ strategy.pk }}" role="button" data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Suivant</span>
                                      </a>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                        {% endif %}
                    {% endwith %}
                {% else %}
                    Pas de capture
                {% endif %}
            </td>
            <td>
                <a href="{% url 'strategy_detail' strategy.pk %}" class="btn btn-info btn-sm">Voir</a>
                <a href="{% url 'strategy_edit' strategy.pk %}" class="btn btn-warning btn-sm">Modifier</a>
                <a href="{% url 'strategy_delete' strategy.pk %}" class="btn btn-danger btn-sm">Supprimer</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">Aucune stratégie trouvée.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
